---
import { Mail, Linkedin, Github, X, Send } from "lucide-astro";
---

<section id="contact" class="py-32 bg-transparent relative">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center relative z-10">
    <!-- Decorative line -->
    <div
      class="gsap-contact-line w-16 h-0.5 bg-gradient-to-r from-amber-400 to-amber-600 mx-auto mb-12 origin-left scale-x-0"
    >
    </div>

    <h2
      class="gsap-contact-title text-4xl md:text-5xl font-bold font-serif text-slate-900 dark:text-white mb-6 opacity-0"
    >
      Mari Bekerja Sama
    </h2>
    <p
      class="gsap-contact-desc text-slate-600 dark:text-slate-400 text-lg mb-12 max-w-xl mx-auto font-sans leading-relaxed opacity-0"
    >
      Saya selalu terbuka untuk mendiskusikan proyek baru, ide kreatif, atau
      peluang untuk menjadi bagian dari visi Anda.
    </p>

    <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
      <button
        id="openEmailModal"
        class="gsap-contact-btn opacity-0 scale-90 group flex items-center gap-3 px-8 py-4 bg-slate-900 dark:bg-white text-white dark:text-slate-950 rounded-full font-medium transition-all hover:bg-slate-800 dark:hover:bg-slate-200 hover:shadow-xl hover:shadow-amber-500/10"
      >
        <Mail class="w-5 h-5" />
        <span>Kirim Email</span>
      </button>
      <a
        href="https://www.linkedin.com/in/grantly-antonio-edward-sorongan-87109b349/"
        class="gsap-contact-btn opacity-0 scale-90 group flex items-center gap-3 px-8 py-4 bg-transparent border border-slate-300 dark:border-slate-700 hover:border-amber-500 dark:hover:border-amber-500 text-slate-900 dark:text-white rounded-full font-medium transition-all"
      >
        <Linkedin
          class="w-5 h-5 text-slate-600 dark:text-slate-400 group-hover:text-amber-500"
        />
        <span>LinkedIn</span>
      </a>
      <a
        href="https://github.com/grenly-del"
        class="gsap-contact-btn opacity-0 scale-90 group flex items-center gap-3 px-8 py-4 bg-transparent border border-slate-300 dark:border-slate-700 hover:border-amber-500 dark:hover:border-amber-500 text-slate-900 dark:text-white rounded-full font-medium transition-all"
      >
        <Github
          class="w-5 h-5 text-slate-600 dark:text-slate-400 group-hover:text-amber-500"
        />
        <span>GitHub</span>
      </a>
    </div>
  </div>
</section>

<!-- Email Modal -->
<div
  id="emailModal"
  class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-300"
>
  <div
    id="modalContent"
    class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-lg w-full p-8 transform scale-95 transition-transform duration-300 border border-slate-200 dark:border-slate-800"
  >
    <!-- Modal Header -->
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div
          class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center"
        >
          <Mail class="w-6 h-6 text-white" />
        </div>
        <h3
          class="text-2xl font-bold font-serif text-slate-900 dark:text-white"
        >
          Kirim Pesan
        </h3>
      </div>
      <button
        id="closeEmailModal"
        class="w-10 h-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center transition-colors"
      >
        <X class="w-5 h-5 text-slate-600 dark:text-slate-400" />
      </button>
    </div>

    <!-- Form -->
    <form id="emailForm" class="space-y-5">
      <!-- Name Input -->
      <div>
        <label
          for="name"
          class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >Nama Lengkap</label
        >
        <input
          type="text"
          id="name"
          name="name"
          required
          placeholder="Masukkan nama Anda"
          class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all"
        />
      </div>

      <!-- Email Input -->
      <div>
        <label
          for="email"
          class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >Email</label
        >
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="nama@example.com"
          class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all"
        />
      </div>

      <!-- Message Textarea -->
      <div>
        <label
          for="message"
          class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >Pesan</label
        >
        <textarea
          id="message"
          name="message"
          required
          rows="5"
          placeholder="Ceritakan tentang proyek Anda..."
          class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all resize-none"
        ></textarea>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        id="submitBtn"
        class="w-full px-6 py-4 bg-gradient-to-r from-amber-400 to-amber-600 hover:from-amber-500 hover:to-amber-700 text-white font-medium rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-amber-500/30 hover:shadow-xl hover:shadow-amber-500/40"
      >
        <Send class="w-5 h-5" />
        <span id="btnText">Kirim Pesan</span>
      </button>
    </form>

    <!-- Success Message (hidden by default) -->
    <div id="successMessage" class="hidden text-center py-8">
      <div
        class="w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mx-auto mb-4"
      >
        <svg
          class="w-8 h-8 text-green-600 dark:text-green-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      <h4 class="text-xl font-bold text-slate-900 dark:text-white mb-2">
        Pesan Terkirim!
      </h4>
      <p class="text-slate-600 dark:text-slate-400">
        Terima kasih! Saya akan segera menghubungi Anda.
      </p>
    </div>
  </div>
</div>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    // Set initial states
    gsap.set(".gsap-contact-title", { y: 30 });
    gsap.set(".gsap-contact-desc", { y: 20 });

    const contactTl = gsap.timeline({
      scrollTrigger: {
        trigger: "#contact",
        start: "top 75%",
      },
      defaults: { ease: "power3.out" },
    });

    contactTl
      .to(".gsap-contact-line", {
        scaleX: 1,
        duration: 0.8,
        ease: "power2.inOut",
      })
      .to(
        ".gsap-contact-title",
        {
          opacity: 1,
          y: 0,
          duration: 1,
        },
        "-=0.3",
      )
      .to(
        ".gsap-contact-desc",
        {
          opacity: 1,
          y: 0,
          duration: 0.8,
        },
        "-=0.5",
      )
      .to(
        ".gsap-contact-btn",
        {
          opacity: 1,
          scale: 1,
          duration: 0.6,
          stagger: 0.12,
          ease: "back.out(1.4)",
        },
        "-=0.3",
      );

    // Modal functionality
    const modal = document.getElementById("emailModal");
    const modalContent = document.getElementById("modalContent");
    const openBtn = document.getElementById("openEmailModal");
    const closeBtn = document.getElementById("closeEmailModal");
    const form = document.getElementById("emailForm") as HTMLFormElement;
    const successMessage = document.getElementById("successMessage");
    const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement;
    const btnText = document.getElementById("btnText");

    function openModal() {
      if (!modal || !modalContent) return;
      modal.classList.remove("pointer-events-none");
      gsap.to(modal, { opacity: 1, duration: 0.3 });
      gsap.to(modalContent, { scale: 1, duration: 0.3, ease: "back.out(1.4)" });
      document.body.style.overflow = "hidden";
    }

    function closeModal() {
      if (!modal || !modalContent) return;
      gsap.to(modal, { opacity: 0, duration: 0.3 });
      gsap.to(modalContent, { scale: 0.95, duration: 0.3 });
      setTimeout(() => {
        modal.classList.add("pointer-events-none");
        document.body.style.overflow = "";
        // Reset form
        form?.reset();
        form?.classList.remove("hidden");
        successMessage?.classList.add("hidden");
      }, 300);
    }

    openBtn?.addEventListener("click", openModal);
    closeBtn?.addEventListener("click", closeModal);
    modal?.addEventListener("click", (e) => {
      if (e.target === modal) closeModal();
    });

    // Form submission
    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!submitBtn || !btnText || !form || !successMessage) return;

      const formData = new FormData(form);
      const data = {
        name: formData.get("name") as string,
        email: formData.get("email") as string,
        message: formData.get("message") as string,
      };

      // Disable button and show loading
      submitBtn.disabled = true;
      btnText.textContent = "Mengirim...";

      try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbwVFqjPPctBkeo9V8v-pMiCGW5OOSBodlLt3FtT-ex6AA5HydAlylvj62hitWXrEhY_3g/exec",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          },
        );

        // Show success message
        form.classList.add("hidden");
        successMessage.classList.remove("hidden");

        // Close modal after 2 seconds
        setTimeout(() => {
          closeModal();
        }, 2500);
      } catch (error) {
        console.error("Error:", error);
        alert("Terjadi kesalahan. Silakan coba lagi.");
      } finally {
        submitBtn.disabled = false;
        btnText.textContent = "Kirim Pesan";
      }
    });
  });
</script>
