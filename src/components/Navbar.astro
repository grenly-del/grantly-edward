---
import { Menu, X } from "lucide-astro";
import ThemeToggle from "./ThemeToggle.astro";

const navItems = [
  { name: "About", href: "/#about" },
  { name: "Experience", href: "/#experience" },
  { name: "Projects", href: "/#projects" },
  { name: "Skills", href: "/#skills" },
  { name: "Certifications", href: "/#certifications" },
  { name: "Gallery", href: "/#gallery" },
  { name: "Contact", href: "/#contact" },
];
---

<header
  class="fixed top-0 w-full z-50 transition-all duration-500 bg-white/80 dark:bg-slate-950/80 backdrop-blur-md border-b border-slate-200/50 dark:border-slate-800/50"
  id="navbar"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a
        href="/"
        class="gsap-nav-logo text-2xl font-bold font-serif tracking-tighter text-slate-900 dark:text-white group opacity-0"
      >
        GS<span
          class="text-amber-500 inline-block group-hover:rotate-12 transition-transform duration-300"
          >.</span
        >
      </a>

      <!-- Desktop Menu -->
      <nav class="hidden md:flex items-center gap-8">
        {
          navItems.map((item, i) => (
            <a
              href={item.href}
              class={`gsap-nav-link opacity-0 text-sm font-medium tracking-wide uppercase text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-all duration-300 relative group`}
            >
              {item.name}
              <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-amber-400 to-amber-600 transition-all duration-500 group-hover:w-full" />
            </a>
          ))
        }

        <div
          class="w-px h-6 bg-slate-200 dark:bg-slate-800 mx-2 gsap-nav-link opacity-0"
        >
        </div>
      </nav>

      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center gap-4">
        <button
          id="menu-btn"
          class="text-slate-900 dark:text-white focus:outline-none relative w-6 h-6"
        >
          <span id="menu-icon"><Menu class="w-6 h-6" /></span>
          <span id="close-icon" class="hidden"><X class="w-6 h-6" /></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden absolute top-20 left-0 w-full bg-white/95 dark:bg-slate-950/95 backdrop-blur-xl border-b border-slate-200 dark:border-slate-800 shadow-2xl"
  >
    <div class="px-4 py-8 space-y-6 flex flex-col items-center">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="mobile-nav-link text-lg font-medium font-serif text-slate-900 dark:text-white hover:text-amber-500 dark:hover:text-amber-400 transition-colors opacity-0 translate-y-4"
          >
            {item.name}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  import { gsap } from "gsap";

  // Navbar entrance animation
  document.addEventListener("DOMContentLoaded", () => {
    const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

    // Logo drops in
    tl.to(".gsap-nav-logo", {
      opacity: 1,
      y: 0,
      duration: 0.8,
      delay: 0.2,
    })
      // Links stagger in
      .to(
        ".gsap-nav-link",
        {
          opacity: 1,
          y: 0,
          duration: 0.6,
          stagger: 0.08,
        },
        "-=0.4",
      );

    // Set initial states
    gsap.set(".gsap-nav-logo", { y: -20 });
    gsap.set(".gsap-nav-link", { y: -15 });
  });

  // Mobile menu
  const mobileMenuBtn = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon");
  const closeIcon = document.getElementById("close-icon");

  if (mobileMenuBtn && mobileMenu && menuIcon && closeIcon) {
    mobileMenuBtn.addEventListener("click", () => {
      const isHidden = mobileMenu.classList.contains("hidden");
      mobileMenu.classList.toggle("hidden");
      menuIcon.classList.toggle("hidden");
      closeIcon.classList.toggle("hidden");

      if (isHidden) {
        // Animate mobile links in
        gsap.fromTo(
          ".mobile-nav-link",
          { opacity: 0, y: 20 },
          {
            opacity: 1,
            y: 0,
            duration: 0.4,
            stagger: 0.06,
            ease: "power2.out",
          },
        );
      }
    });

    const mobileLinks = mobileMenu.querySelectorAll("a");
    mobileLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
      });
    });
  }

  // Scroll effect - navbar gets compact + shadow
  const navbar = document.getElementById("navbar");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      navbar?.classList.add(
        "shadow-lg",
        "shadow-slate-900/5",
        "dark:shadow-amber-500/5",
      );
      navbar?.classList.remove(
        "border-slate-200/50",
        "dark:border-slate-800/50",
      );
      navbar?.classList.add("border-slate-200", "dark:border-slate-800");
    } else {
      navbar?.classList.remove(
        "shadow-lg",
        "shadow-slate-900/5",
        "dark:shadow-amber-500/5",
      );
      navbar?.classList.remove("border-slate-200", "dark:border-slate-800");
      navbar?.classList.add("border-slate-200/50", "dark:border-slate-800/50");
    }
  });

  // Active section highlighting
  const sections = document.querySelectorAll("section[id]");
  const navLinks = document.querySelectorAll(".gsap-nav-link[href]");

  const observerOptions = {
    rootMargin: "-20% 0px -60% 0px",
    threshold: 0,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute("id");
        navLinks.forEach((link) => {
          const href = link.getAttribute("href");
          const isActive = href === `/#${id}`;
          const underline = link.querySelector("span");

          if (isActive) {
            link.classList.add("!text-slate-900", "dark:!text-white");
            link.classList.remove("text-slate-500", "dark:text-slate-400");
            if (underline) underline.style.width = "100%";
          } else {
            link.classList.remove("!text-slate-900", "dark:!text-white");
            link.classList.add("text-slate-500", "dark:text-slate-400");
            if (underline) underline.style.width = "";
          }
        });
      }
    });
  }, observerOptions);

  sections.forEach((section) => observer.observe(section));
</script>
