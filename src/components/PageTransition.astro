---

---

<!-- Page Transition Overlay -->
<div
    id="page-transition"
    class="fixed inset-0 z-[9999] pointer-events-none"
    aria-hidden="true"
>
    <!-- Single black curtain panel -->
    <div
        id="transition-curtain"
        class="absolute inset-0 bg-black translate-y-full will-change-transform"
    >
    </div>

    <!-- Gold accent line -->
    <div
        id="transition-gold-line"
        class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 h-[2px] w-0 opacity-0 z-10"
    >
        <div
            class="w-full h-full bg-gradient-to-r from-transparent via-amber-400 to-transparent"
        >
        </div>
    </div>
</div>

<script>
    import { gsap } from "gsap";

    const CURTAIN_DURATION = 0.55;
    const LINE_DURATION = 0.4;
    const EASE = "power4.inOut";

    function initPageTransition() {
        const curtain = document.getElementById("transition-curtain");
        const overlay = document.getElementById("page-transition");
        const goldLine = document.getElementById("transition-gold-line");

        if (!curtain || !overlay || !goldLine) return;

        // === ENTRANCE: Gold line shrinks → curtain slides UP to reveal ===
        if (
            document.documentElement.classList.contains("is-page-transitioning")
        ) {
            document.documentElement.classList.remove("is-page-transitioning");
            sessionStorage.removeItem("page-transitioning");

            // Curtain covers the screen (set by CSS instantly), gold line is expanded
            gsap.set(curtain, { y: "0%" });
            gsap.set(goldLine, { width: "80vw", opacity: 1 });
            overlay.style.pointerEvents = "all";

            const enterTl = gsap.timeline({
                delay: 0.15,
                onComplete: () => {
                    overlay.style.pointerEvents = "none";
                    gsap.set(curtain, { y: "100%" });
                    gsap.set(goldLine, { width: 0, opacity: 0 });
                },
            });

            // 1. Gold line shrinks back to center
            enterTl.to(goldLine, {
                width: 0,
                opacity: 0,
                duration: LINE_DURATION * 0.7,
                ease: "power2.in",
            });

            // 2. Curtain slides UP to reveal the new page
            enterTl.to(
                curtain,
                {
                    y: "-100%",
                    duration: CURTAIN_DURATION,
                    ease: EASE,
                },
                "-=0.1",
            );
        }

        // === EXIT: Curtain UP from bottom → gold line expands → navigate ===
        document.addEventListener("click", (e) => {
            const anchor = (e.target as HTMLElement).closest("a");
            if (!anchor) return;

            const href = anchor.getAttribute("href");
            if (!href) return;

            // Skip external links, anchors, and special links
            if (
                href.startsWith("http") ||
                href.startsWith("mailto:") ||
                href.startsWith("tel:") ||
                href.startsWith("#") ||
                anchor.hasAttribute("target")
            ) {
                return;
            }

            // Skip same-page hash links like /#projects
            const currentPath = window.location.pathname;
            if (href.startsWith("/#") && currentPath === "/") {
                return;
            }

            e.preventDefault();
            overlay.style.pointerEvents = "all";
            sessionStorage.setItem("page-transitioning", "true");

            // Reset positions
            gsap.set(curtain, { y: "100%" });
            gsap.set(goldLine, { width: 0, opacity: 0 });

            const exitTl = gsap.timeline({
                onComplete: () => {
                    window.location.href = href;
                },
            });

            // 1. Black curtain slides UP from bottom to cover page
            exitTl.to(curtain, {
                y: "0%",
                duration: CURTAIN_DURATION,
                ease: EASE,
            });

            // 2. Gold line expands from center horizontally
            exitTl.to(
                goldLine,
                {
                    width: "80vw",
                    opacity: 1,
                    duration: LINE_DURATION,
                    ease: "power2.out",
                },
                "-=0.05",
            );
        });
    }

    // Run on initial load
    document.addEventListener("DOMContentLoaded", initPageTransition);
</script>

<style is:global>
    /* When transitioning, instantly cover the screen with the curtain
       BEFORE any JavaScript loads — prevents white flash */
    .is-page-transitioning #transition-curtain {
        transform: translateY(0%) !important;
    }
</style>

<style>
    #transition-gold-line {
        box-shadow:
            0 0 15px rgba(251, 191, 36, 0.5),
            0 0 40px rgba(251, 191, 36, 0.15);
    }
</style>
